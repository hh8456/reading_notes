为了解决分段机制的问题,比如空闲内存小于要加载的段,或者空闲区域远远大于要加载的段而造成浪费,引入了分页机制
分段模式下, CPU段部件会把段地址和偏移地址转换成一个线性地址,这个线性地址就是物理地址; 

32位分页模式下,每页按 4096 字节进行划分,操作系统会为所有任务创建一个共用的 4GB 虚拟内存空间,或者为每个任务创建一个 4GB 的虚拟内存空间
不同任务的虚拟地址可能相同,但指向的物理地址却是不同的

当加载一个程序时, OS 会在虚拟内存中分配段空间,根据段需要多少页来搜索空闲页面, 同时在物理内存中分配相应的页面,并把段映射到不同的页面
CPU段部件把段地址和偏移地址转换成的线性地址是虚拟地址,虚拟地址转成物理地址,是由CPU页部件完成的

虚拟内存中,一个连续的段空间, 可能会映射在几个不连续的页面上

每个任务有 4GB 虚拟内存,也有自己的页映射表, 而物理内存也就 4GB,如果出现不够分的情况, OS 会将不用的页面保存到磁盘,腾出空间来给马上运行的任务使用

分页结构层次化:
用一个页表存放随机的 1024 个页的地址,每个页表 4KB
把 1048567 个页归拢到 1024 个页表后,再用一个 4KB 的表来指向这 1024 个页表,这就是页目录表

每个任务都有页目录表和页表,页表和页目录表也是普通的页,混迹于全部的物理页中,和普通页相比就只是功能不同,当任务撤销后,他们和任务所占的普通页会被回收,并分配给其他任务 

CPU 寄存器 CR3存放当前任务页目录的物理地址, CR3 又叫做页目录基址寄存器
每个任务的任务状态段 TSS 存放了任务相关的各种数据,其中就包括了 CR3 寄存器域,存放了任务自己的页目录物理地址
任务切换时, CPU 寄存器 CR3 的内容会被更新

页物理地址是 32 位, 因为是 4KB 对齐,所以用了高 20 位, 低12位必然是 0 , 
页目录项(页表项)的组成中, 高 20 位表示页表(页)物理地址的 31-12, 低 12 位包含了各种状态位,指示了页表(页)的若干属性,比如是否存在内存中,是否可写,是否允许特权级别3的程序访问,是否使用高速缓存等等

控制寄存器 CR0 的最高位(第31位) 是 PG(page)为,用于开启或者关闭页功能,清零时页功能被关闭,段部件产生的线性地址是物理地址
置位时开启,段部件产生的地址不再被看成物理地址,而是要送往页部件变换,以得到真正的物理地址; 开启页功能后,除了页目录表和页表的地址外,其他所有地址都是线性地址

当任务创建时,自己的页目录表和页表一同被创建,两者不仅仅包含了任务的私有页面,还包含了(为所有任务共用的)内存全局空间的页表,这样转到内核中执行时,才能进行地址转换

操作系统要记录下所有的物理页的占用情况,可以使用位串来指示页的分配情况; 
位 0 表示对应物理页地址 0x0...0 的页, 位 1 对应的是物理地址为 0x0...1000 的页, 位 2 对应的是物理地址为 0x0...2000 的页
比特的值表示是否被占用, 0 未占用, 1 已占用